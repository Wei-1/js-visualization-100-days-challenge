<html>
<body style="background-color:#fff;">
    <canvas id="canvas" style="position:absolute;top:0%;left:0%" onmousedown="downE(event)" onmouseup="upE(event)" onmousemove="moveE(event)"></canvas>
    <script>

let width = window.innerWidth
|| document.documentElement.clientWidth
|| document.body.clientWidth;

let height = window.innerHeight
|| document.documentElement.clientHeight
|| document.body.clientHeight;

const canvas = document.getElementById('canvas');
canvas.width  = width;
canvas.height = height;
const ctx = canvas.getContext('2d');

const retrive = 5000;
const speed = 3;
const length = Math.min(width, height) / 5;
const radius = length * 0.7;
const lRatio = 0.01;
const cx = width / 2;
const cy = height / 2;
const range = 50;
const tRatio = 0.1;
const aGap = 5;

let cities = [[80,-15],[80,-85],[75,-55],[75,-70],[75,-85],[70,135],[70,90],[70,35],[70,30],[70,30],[70,25],[70,25],[70,20],[70,20],[70,20],[70,-135],[70,-150],[70,-155],[65,180],[65,40],[65,30],[65,30],[65,25],[65,25],[65,25],[65,25],[65,25],[65,25],[65,25],[65,20],[65,20],[65,20],[65,20],[65,20],[65,20],[65,20],[65,15],[65,15],[65,10],[65,10],[65,-20],[65,-20],[65,-25],[65,-50],[65,-70],[65,-150],[60,150],[60,130],[60,55],[60,40],[60,30],[60,25],[60,25],[60,25],[60,25],[60,25],[60,25],[60,25],[60,25],[60,20],[60,20],[60,20],[60,15],[60,15],[60,10],[60,10],[60,10],[60,10],[60,10],[60,5],[60,-5],[60,-45],[60,-115],[60,-135],[60,-135],[60,-150],[55,160],[55,100],[55,95],[55,85],[55,75],[55,60],[55,60],[55,55],[55,55],[55,50],[55,50],[55,50],[55,45],[55,40],[55,30],[55,25],[55,25],[55,20],[55,20],[55,20],[55,15],[55,15],[55,15],[55,10],[55,10],[55,10],[55,10],[55,10],[55,10],[55,5],[55,0],[55,0],[55,0],[55,0],[55,0],[55,0],[55,0],[55,0],[55,0],[55,0],[55,-5],[55,-5],[55,-5],[55,-5],[55,-5],[55,-5],[55,-5],[55,-5],[55,-110],[55,-115],[55,-120],[55,-135],[50,105],[50,105],[50,70],[50,45],[50,45],[50,40],[50,35],[50,30],[50,25],[50,20],[50,20],[50,15],[50,15],[50,15],[50,15],[50,15],[50,15],[50,10],[50,10],[50,10],[50,10],[50,10],[50,10],[50,10],[50,5],[50,5],[50,5],[50,5],[50,5],[50,5],[50,5],[50,5],[50,5],[50,5],[50,5],[50,5],[50,5],[50,5],[50,5],[50,0],[50,0],[50,0],[50,0],[50,0],[50,0],[50,0],[50,0],[50,0],[50,0],[50,0],[50,0],[50,0],[50,0],[50,0],[50,0],[50,-5],[50,-5],[50,-5],[50,-5],[50,-5],[50,-5],[50,-10],[50,-55],[50,-90],[50,-95],[50,-105],[50,-105],[50,-115],[50,-120],[50,-120],[50,-120],[50,-125],[50,-125],[50,-175],[45,145],[45,140],[45,130],[45,125],[45,125],[45,90],[45,75],[45,75],[45,40],[45,40],[45,40],[45,40],[45,35],[45,30],[45,30],[45,30],[45,25],[45,25],[45,25],[45,25],[45,20],[45,20],[45,20],[45,20],[45,20],[45,15],[45,15],[45,15],[45,15],[45,10],[45,10],[45,10],[45,10],[45,10],[45,10],[45,10],[45,10],[45,10],[45,5],[45,5],[45,5],[45,5],[45,5],[45,5],[45,5],[45,5],[45,0],[45,0],[45,0],[45,0],[45,-5],[45,-55],[45,-65],[45,-65],[45,-65],[45,-65],[45,-65],[45,-65],[45,-70],[45,-70],[45,-70],[45,-75],[45,-75],[45,-75],[45,-80],[45,-80],[45,-80],[45,-80],[45,-80],[45,-85],[45,-90],[45,-95],[45,-100],[45,-100],[45,-110],[45,-115],[45,-125],[40,140],[40,130],[40,125],[40,125],[40,125],[40,125],[40,125],[40,120],[40,115],[40,115],[40,115],[40,115],[40,70],[40,70],[40,70],[40,60],[40,60],[40,50],[40,45],[40,45],[40,45],[40,45],[40,45],[40,35],[40,30],[40,30],[40,30],[40,30],[40,25],[40,25],[40,25],[40,25],[40,20],[40,20],[40,20],[40,15],[40,15],[40,15],[40,15],[40,15],[40,10],[40,10],[40,5],[40,0],[40,0],[40,0],[40,0],[40,0],[40,-5],[40,-10],[40,-10],[40,-25],[40,-25],[40,-30],[40,-30],[40,-70],[40,-70],[40,-75],[40,-75],[40,-75],[40,-75],[40,-75],[40,-75],[40,-75],[40,-75],[40,-75],[40,-80],[40,-80],[40,-80],[40,-85],[40,-85],[40,-85],[40,-85],[40,-85],[40,-85],[40,-85],[40,-90],[40,-90],[40,-95],[40,-95],[40,-95],[40,-95],[40,-105],[40,-105],[40,-105],[40,-110],[40,-120],[40,-120],[40,-120],[35,140],[35,140],[35,140],[35,135],[35,135],[35,135],[35,135],[35,130],[35,130],[35,130],[35,130],[35,125],[35,120],[35,115],[35,115],[35,115],[35,110],[35,105],[35,100],[35,75],[35,75],[35,75],[35,70],[35,70],[35,60],[35,50],[35,50],[35,45],[35,45],[35,45],[35,45],[35,35],[35,35],[35,35],[35,35],[35,35],[35,35],[35,35],[35,25],[35,15],[35,15],[35,15],[35,10],[35,10],[35,5],[35,0],[35,-5],[35,-5],[35,-5],[35,-5],[35,-10],[35,-15],[35,-75],[35,-80],[35,-80],[35,-80],[35,-80],[35,-85],[35,-85],[35,-85],[35,-85],[35,-90],[35,-90],[35,-95],[35,-95],[35,-95],[35,-100],[35,-105],[35,-105],[35,-105],[35,-110],[35,-115],[35,-115],[35,-115],[35,-115],[35,-115],[35,-120],[35,-120],[30,120],[30,120],[30,120],[30,115],[30,105],[30,105],[30,90],[30,90],[30,85],[30,75],[30,75],[30,75],[30,75],[30,75],[30,75],[30,75],[30,70],[30,65],[30,50],[30,50],[30,35],[30,35],[30,35],[30,35],[30,35],[30,35],[30,30],[30,30],[30,30],[30,20],[30,-10],[30,-15],[30,-15],[30,-65],[30,-80],[30,-80],[30,-80],[30,-90],[30,-90],[30,-90],[30,-95],[30,-100],[30,-100],[30,-105],[30,-105],[30,-105],[30,-110],[30,-110],[30,-115],[25,130],[25,120],[25,120],[25,120],[25,120],[25,115],[25,115],[25,115],[25,110],[25,105],[25,95],[25,95],[25,90],[25,90],[25,90],[25,90],[25,90],[25,90],[25,90],[25,90],[25,85],[25,80],[25,80],[25,80],[25,80],[25,75],[25,75],[25,70],[25,65],[25,60],[25,55],[25,55],[25,50],[25,50],[25,50],[25,45],[25,40],[25,35],[25,15],[25,-15],[25,-75],[25,-80],[25,-80],[25,-80],[25,-100],[25,-105],[25,-105],[25,-105],[25,-110],[20,115],[20,115],[20,105],[20,105],[20,105],[20,100],[20,100],[20,95],[20,90],[20,85],[20,80],[20,75],[20,75],[20,75],[20,40],[20,40],[20,-15],[20,-65],[20,-65],[20,-65],[20,-65],[20,-70],[20,-70],[20,-70],[20,-75],[20,-75],[20,-80],[20,-85],[20,-90],[20,-90],[20,-95],[20,-100],[20,-100],[20,-100],[20,-100],[20,-100],[20,-100],[20,-100],[20,-105],[20,-105],[20,-105],[20,-155],[20,-160],[15,145],[15,145],[15,145],[15,120],[15,120],[15,120],[15,110],[15,110],[15,105],[15,105],[15,105],[15,100],[15,100],[15,100],[15,100],[15,95],[15,80],[15,80],[15,80],[15,55],[15,45],[15,40],[15,35],[15,30],[15,0],[15,-5],[15,-10],[15,-10],[15,-15],[15,-15],[15,-15],[15,-15],[15,-15],[15,-25],[15,-60],[15,-60],[15,-60],[15,-60],[15,-60],[15,-60],[15,-60],[15,-65],[15,-70],[15,-85],[15,-85],[15,-90],[15,-90],[15,-90],[15,-90],[15,-90],[15,-100],[10,125],[10,125],[10,125],[10,105],[10,105],[10,100],[10,100],[10,95],[10,80],[10,75],[10,75],[10,45],[10,45],[10,40],[10,15],[10,15],[10,10],[10,5],[10,0],[10,0],[10,-5],[10,-10],[10,-15],[10,-15],[10,-15],[10,-60],[10,-60],[10,-60],[10,-60],[10,-65],[10,-65],[10,-70],[10,-70],[10,-70],[10,-75],[10,-75],[10,-75],[10,-80],[10,-85],[10,-85],[10,-85],[10,-85],[10,-85],[10,-85],[5,170],[5,160],[5,150],[5,135],[5,135],[5,125],[5,120],[5,115],[5,115],[5,115],[5,100],[5,100],[5,100],[5,100],[5,100],[5,100],[5,100],[5,95],[5,80],[5,80],[5,80],[5,75],[5,30],[5,20],[5,10],[5,10],[5,10],[5,10],[5,5],[5,5],[5,5],[5,5],[5,5],[5,0],[5,0],[5,0],[5,0],[5,0],[5,-5],[5,-5],[5,-10],[5,-50],[5,-55],[5,-60],[5,-60],[5,-70],[5,-75],[5,-75],[5,-75],[0,165],[0,115],[0,110],[0,100],[0,45],[0,35],[0,30],[0,-50],[0,-80],[0,-80],[0,175],[0,110],[0,105],[0,105],[0,100],[0,100],[0,45],[0,35],[0,30],[0,10],[0,5],[0,-50],[-5,140],[-5,130],[-5,120],[-5,115],[-5,110],[-5,110],[-5,105],[-5,105],[-5,105],[-5,55],[-5,40],[-5,40],[-5,40],[-5,35],[-5,35],[-5,30],[-5,15],[-5,15],[-5,-30],[-5,-35],[-5,-35],[-5,-35],[-5,-40],[-5,-40],[-5,-40],[-5,-45],[-5,-45],[-5,-45],[-5,-60],[-5,-75],[-10,180],[-10,180],[-10,160],[-10,145],[-10,130],[-10,125],[-10,115],[-10,115],[-10,110],[-10,45],[-10,25],[-10,15],[-10,-35],[-10,-35],[-10,-35],[-10,-35],[-10,-35],[-10,-40],[-10,-50],[-10,-55],[-10,-65],[-10,-70],[-10,-75],[-10,-80],[-15,180],[-15,145],[-15,45],[-15,35],[-15,35],[-15,30],[-15,30],[-15,15],[-15,-5],[-15,-40],[-15,-40],[-15,-50],[-15,-50],[-15,-55],[-15,-70],[-15,-70],[-15,-70],[-15,-75],[-15,-170],[-15,-170],[-15,-175],[-15,-180],[-20,180],[-20,170],[-20,165],[-20,145],[-20,120],[-20,60],[-20,55],[-20,50],[-20,35],[-20,30],[-20,30],[-20,30],[-20,30],[-20,25],[-20,-40],[-20,-40],[-20,-45],[-20,-45],[-20,-45],[-20,-50],[-20,-50],[-20,-50],[-20,-50],[-20,-50],[-20,-55],[-20,-65],[-20,-65],[-20,-70],[-20,-70],[-20,-70],[-20,-150],[-20,-160],[-20,-170],[-20,-175],[-25,155],[-25,150],[-25,35],[-25,30],[-25,30],[-25,30],[-25,30],[-25,30],[-25,30],[-25,30],[-25,25],[-25,25],[-25,15],[-25,-45],[-25,-45],[-25,-45],[-25,-45],[-25,-50],[-25,-50],[-25,-55],[-25,-60],[-25,-65],[-25,-65],[-25,-70],[-25,-70],[-25,-110],[-25,-130],[-30,170],[-30,155],[-30,115],[-30,30],[-30,30],[-30,25],[-30,25],[-30,25],[-30,-50],[-30,-50],[-30,-50],[-30,-65],[-30,-70],[-35,175],[-35,150],[-35,150],[-35,150],[-35,150],[-35,140],[-35,115],[-35,25],[-35,25],[-35,20],[-35,-55],[-35,-55],[-35,-60],[-35,-60],[-35,-70],[-35,-70],[-35,-70],[-35,-75],[-40,175],[-40,175],[-40,175],[-40,175],[-40,145],[-40,145],[-40,-60],[-40,-70],[-40,-75],[-40,-75],[-40,-75],[-45,175],[-45,170],[-45,170],[-45,145],[-45,-65],[-45,-65],[-45,-70],[-45,-75],[-50,-60],[-50,-70],[-55,-35],[-55,-65],[-55,-70],[-55,-70],[-55,-70]];

function randomLL(){
    let i = Math.floor(Math.random() * cities.length);
    return cities[i];
}

function xyz2(x, y, z){
    let nx = cx + x * ((z + length * 2) * lRatio);
    let ny = cy + -y * ((z + length * 2) * lRatio);
    return [nx, ny];
}

function getBox(l){
    let tarr = [];
    tarr.push([[-l,-l,-l], [-l,-l, l]]);
    tarr.push([[ l,-l,-l], [ l,-l, l]]);
    tarr.push([[-l, l,-l], [-l, l, l]]);
    tarr.push([[ l, l,-l], [ l, l, l]]);
    tarr.push([[-l,-l,-l], [ l,-l,-l]]);
    tarr.push([[-l, l,-l], [ l, l,-l]]);
    tarr.push([[-l,-l, l], [ l,-l, l]]);
    tarr.push([[-l, l, l], [ l, l, l]]);
    tarr.push([[-l,-l,-l], [-l, l,-l]]);
    tarr.push([[ l,-l,-l], [ l, l,-l]]);
    tarr.push([[-l,-l, l], [-l, l, l]]);
    tarr.push([[ l,-l, l], [ l, l, l]]);
    return tarr;
}

function ll2XYZ(lat, lon, rad){
    lat = lat * Math.PI / 180;
    lon = lon * Math.PI / 180;
    let cosLat = Math.cos(lat);
    let sinLat = Math.sin(lat);
    let x = rad * cosLat * Math.sin(lon);
    let y = rad * sinLat;
    let z = rad * cosLat * Math.cos(lon);
    return [x, y, z];
}

function getBall(l){
    let tarr = [];
    for(let i = -180; i < 180; i += aGap){
        let a = [];
        for(let j = -90; j <= 90; j += aGap){
            a.push(ll2XYZ(j, i, l));
        }
        tarr.push(a);
    }
    for(let i = -90 + aGap; i <= 90 - aGap; i += aGap){
        let a = [];
        for(let j = -180; j <= 180; j += aGap){
            a.push(ll2XYZ(i, j, l));
        }
        tarr.push(a);
    }
    return tarr;
}

function getCities(radius){
    return cities.map((ci) => ll2XYZ(ci[0], ci[1], radius));
}

let box = getBox(length);
let arr = getBall(radius);
let carr = getCities(radius);

function turnPoint(x, y, z){
    if(sx == ex){
        return [x, y, z];
    }else{
        let dxr = (sx - ex) / 180 * Math.PI * tRatio;
        let rx = Math.sqrt(x * x + z * z);
        let rxr = Math.atan2(z, x);
        let nxr = rxr + dxr;
        let nx = rx * Math.cos(nxr);
        let nz = rx * Math.sin(nxr);
        return [nx, y, nz];
    }
}

function updateArr(arr){
    let tarr = [];
    for(let i = 0; i < arr.length; i ++){
        let a = arr[i];
        tarr.push(a.map((ai) => turnPoint(...ai)));
    }
    return tarr;
}

function updateLon(lon){    
    let dxr = (sx - ex) * tRatio;
    let nlon = lon + dxr;
    if(nlon > 180) nlon -= 360;
    return nlon;
}

ctx.lineWidth = 1;
function drawArr(arr){
    for(let i = 0; i < arr.length; i ++){
        let a = arr[i];
        let na = a.map((ai) => xyz2(...ai));
        ctx.beginPath();
        ctx.moveTo(...na[0]);
        for(let j = 1; j < a.length; j ++){
            ctx.lineTo(...na[j]);
        }
        ctx.stroke();
    }
}

function drawPoint(arr){
    for(let i = 0; i < arr.length; i ++){
        let xy = xyz2(...arr[i]);
        ctx.beginPath();
        ctx.moveTo(xy[0] - 2, xy[1] - 2);
        ctx.lineTo(xy[0] - 2, xy[1] + 2);
        ctx.lineTo(xy[0] + 2, xy[1] + 2);
        ctx.lineTo(xy[0] + 2, xy[1] - 2);
        ctx.lineTo(xy[0] - 2, xy[1] - 2);
        ctx.stroke();
    }
}

let down = false;
let sx = 0, sy = 0, ex = 0, ey = 0;
let slat = 0, slon = 0, elat = 0, elon = 0;
function downE(event){
    down = true;
    sx = event.x;
    sy = event.y;
}

function moveE(event){
    if(down){
        ex = event.x, ey = event.y;
        requestAnimationFrame(loop);
    }
}

function upE(event){
    down = false;
}

function drawAll(){
    ctx.clearRect(0, 0, width, height);
    ctx.strokeStyle = "hsla(0,100%,0%,0.2)";
    drawArr(box);
    ctx.strokeStyle = "hsla(0,100%,0%,0.5)";
    drawArr(arr);
    ctx.strokeStyle = "hsla(0,100%,50%,1)";
    drawPoint(carr);
}
drawAll();

function loop(time){
    arr = updateArr(arr);
    carr = carr.map((ci) => turnPoint(...ci));
    slon = updateLon(slon);
    drawAll();
    sx = ex, sy = ey;
}

function updateloop(time){
    if(!down){
        let dlon = elon - slon;
        dlon = Math.sign(dlon) * Math.min(speed, Math.abs(dlon));
        slon += dlon;
        sx = 0, ex = dlon / tRatio;
        arr = updateArr(arr);
        carr = carr.map((ci) => turnPoint(...ci));
        drawAll();
        sx = 0, ex = 0;
        if(Math.abs(slon - elon) > 0.1){
            requestAnimationFrame(updateloop);
        }
    }
}

function autoloop(time){
    let ll = randomLL();
    elat = ll[0];
    elon = ll[1];
    requestAnimationFrame(updateloop);
    setTimeout(autoloop, retrive);
}
autoloop(0);

    </script>
</body>
</html>